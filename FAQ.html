<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>Fermi LAT Light Curve Repository</title>

    <!-- jQuery -->
    <script type="text/javascript" charset="UTF-8" src="./js/jquery-1.12.0.min.js"></script>

    <!-- Bootstrap compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- Chart.js -->
    <script type="text/javascript" charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

    <!-- Bootstrap compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Bootstrap Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Reset css -->
    <link rel="stylesheet" hrmouseef="./css/reset.css" type="text/css" />

    <!-- NASA theme -->
    <link rel="stylesheet" href="./css/NASA.css">
    
</head>


<!-- custom css -->
<style type="text/css">

</style>

<script>

    var data_4FGL;
    var classifications_4FGL;
    var classifications_LRC
    var colors = ['#0d47a1','#007E33', '#FF8800','#CC0000','#9933CC','#0d47a1','#00C851','#ffbb33','#ff4444','#aa66cc','#00695c','#2BBBAD','#3F729B']




    function countSourceTypes() {

        classifications_4FGL = {}
        classifications_LCR = {}

        console.log(data_4FGL.length)
        for (var i=0, size=data_4FGL.length; i<size; i++) {

            var key = data_4FGL[i].CLASS1
            var variability_index = parseFloat(data_4FGL[i].Variability_Index)

            // Convert all of the classification to upper case
            key = key.toUpperCase();

            if (key.length === 0) {
                key = 'Unknown'
            }

            if (key in classifications_4FGL) {
                classifications_4FGL[key] = classifications_4FGL[key] + 1
            } else {
                classifications_4FGL[key] = 1
            }

            if (variability_index >= 18.49) {

                if (key in classifications_LCR) {
                    classifications_LCR[key] = classifications_LCR[key] + 1
                } else {
                    classifications_LCR[key] = 1
                }
            }

        }


        console.log(classifications_4FGL)
        console.log(classifications_LCR)


    }


    function get4FGLData() {

        console.log('Querying the 4FGL database...')

        // Setup the URL
        URL = "queryDB.php?typeOfRequest=SourceList&catalog=4FGL&magicWord=130427A"; 

        // Print out the final URL
        console.log(URL);

        // Perform an ajax request
        $.ajax({url: URL, success: function(responseText){

            // Get the data
            try {
                data_4FGL = JSON.parse(responseText);
                console.log("4FGL data length = " + data_4FGL.length)
            } catch (error) {
                console.log('Error parsing query response.')
                $('#main').hide()
                return;
            }

            if (data_4FGL.length === 0) {
                alert('Your search found no results!')
                
            } else {

                console.log(data_4FGL)

            }

            countSourceTypes()

            fillDoughnutPlots()


        }});
    }

    function fillDoughnutPlots() {


        try {
            window.myDoughnut1.destroy();
        } catch(err) {
            //
        }

        // Create random data
        var randomScalingFactor = function() {
            return Math.round(Math.random() * 100);
        };

        // Configure the detector distribution plot
        var config1 = {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: Object.values(classifications_4FGL),
                    // data: classificationOccurance,
                    backgroundColor: colors,
                    label: 'Dataset 1'
                }],

                labels: Object.keys(classifications_4FGL)
                // labels: classificationsUnique
            },
            options: {
                responsive: true,
                legend: {
                    display: true,
                    position: 'bottom',                                 
                    labels: { 
                        fontSize: 12,
                        boxWidth: 10,
                        usePointStyle: false,
                        fullWidth: false,
                        fontFamily: 'Helvetica Neue',
                        fontColor: '#333333'
                    }
                },
                title: {
                    display: true,
                    text: '4FGL Classification Distribution',
                    fontFamily: 'Helvetica Neue',
                    fontColor: '#333333',
                    fontSize: 14

                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                },
                layout: {
                    padding: {
                        top: 0
                    }
                }
            }
        };

        var config2 = {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: Object.values(classifications_LCR),
                    // data: classificationOccurance,
                    backgroundColor: colors,
                    label: 'Dataset 1'
                }],

                labels: Object.keys(classifications_LCR)
            },
            options: {
                responsive: true,
                legend: {
                    display: true,
                    position: 'bottom',                                 
                    labels: { 
                        fontSize: 12,
                        boxWidth: 10,
                        usePointStyle: false,
                        fullWidth: false,
                        fontFamily: 'Helvetica Neue',
                        fontColor: '#333333'
                    }
                },
                title: {
                    display: true,
                    text: 'LCR Classification Distribution',
                    fontFamily: 'Helvetica Neue',
                    fontColor: '#333333',
                    fontSize: 14

                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                },
                layout: {
                    padding: {
                        top: 0
                    }
                }
            }
        };


        // Create the detector distribution plot
        var ctx1 = document.getElementById('chart-area_1').getContext('2d');
        window.myDoughnut1 = new Chart(ctx1, config1);

        var ctx2 = document.getElementById('chart-area_2').getContext('2d');
        window.myDoughnut2 = new Chart(ctx2, config2);
    }


    // Query the database when the page is finished loading
    $(function() {


        get4FGLData()

        // countSourceTypes()

        // Fill the doughnut plot
        // fillDoughnutPlots();

        


    })


</script>

<body>


    <!-- main starts here -->       
    <div id="main" style="width:2000px;">    

        <!-- Start NASA Container -->
        <div id="nasa-container" style="margin:8px 0 0 10px">

            <!-- Start NASA Banner -->
            <div id="nasa-banner-plain">

                <!-- Left - Logo -->
                <div class="nasa-logo">
                    <a href="http://www.nasa.gov/"><img src="http://fermi.gsfc.nasa.gov/ssc/inc/img/nasa_logo.gif" width="140" height="98" border="0" alt="NASA Logo"></a>
                </div>
            
                <!-- Middle - Affiliations -->
                <div id="nasa-affiliation">
                    <h1><a href="http://www.nasa.gov/">National Aeronautics and Space Administration</a></h1>
                    <h2><a href="http://www.nasa.gov/goddard">Goddard Space Flight Center</a></h2>
                </div>
                
                <!-- Right - Search and Links -->
                <div id="nasa-search-links">
                    <div id="header-links">
                        <a href="/ssc/">FSSC</a> &bull; <a href="http://heasarc.gsfc.nasa.gov/">HEASARC</a> &bull; <a href="http://science.gsfc.nasa.gov/">Sciences and Exploration</a>
                    </div>
                </div>

            <!-- End NASA Banner -->
            </div>

        <!-- End NASA Container -->
        </div>

        <!-- LCR header starts here -->
        <div style="margin-left:0px">
            <div style="float: left; padding-top:12px; padding-left:25px"><img middle; style="width: 100%; height: 100%" src="./img/Fermi_Small.png"></div>
            <div style="margin-left: 25px;padding-left: 75px; padding-bottom:20px; padding-top: 5px">
                <H2>Fermi LAT Light Curve Repository (LCR)</H2>
            </div>
        </div>
        <!-- LCR header ends here -->

        <!-- sidebar start here -->
        <div class="col-xs-2" style="width:330px; margin-left:10px;">

            <!-- Related resources start here -->      
                <div class="panel panel-default" style="height: 151px;">
                    <div class="panel-heading">
                        <h3 class="panel-title">Light Curve Repository Resources</h3>
                     </div>
                        <center>
                            <table class="table table-striped">
                            <!-- <table class="table"> -->
                              <tbody>           
                                    <tr><td><a href="about.html" target="_blank">About the Light Curve Repository</a></td></tr>      
                                    <tr><td><a href="table_description.html" target="_blank" onclick="window.open(this.href,'targetWindow','width=800px, height=1175px'); return false;"> The Light Curve Repository Data Description</a></td></tr>
                                    <tr><td><a href="FAQ.html" target="_blank">The Light Curve Repository FAQ</a></td></tr>
                              </tbody>
                            </table>  
                        </center>
                </div>
                <!-- Related resources ends here -->   

                <!-- Related resources start here -->      
                <div class="panel panel-default" style="height: 188px;">
                    <div class="panel-heading">
                        <h3 class="panel-title">Additional Information</h3>
                     </div>
                        <center>
                            <table class="table table-striped">
                            <!-- <table class="table"> -->
                              <tbody>           
                                    <tr><td><a href="https://fermi.gsfc.nasa.gov/ssc/">The Fermi Science Support Center</a></td></tr>
                                    <tr><td><a href="https://fermi.gsfc.nasa.gov/ssc/data/analysis/documentation/Cicerone/">Fermi LAT & GBM Analysis Guide</a></td></tr>
                                    <tr><td><a href="https://fermi.gsfc.nasa.gov/ssc/data/access/">Fermi LAT & GBM Data Access</a></td></tr>
                                    <tr><td><a href="https://fermi.gsfc.nasa.gov/ssc/data/access/lat/FAVA/">Fermi All-Sky Variability Analysis (FAVA)</a></td></tr>           
                              </tbody>
                            </table>  
                        </center>
                </div>
                <!-- Related resources ends here -->   

            <!-- Citation request start here -->    
            <div class="panel panel-default">   
                <div class="panel-heading">
                    Please reference <a href="">Kocevski et al. 2021</a> for use of any results presented in the Fermi LAT Light Curve Repository. Also be sure to consult the <a href="about.html">LCR Usage Notes</a> for important details and caveats about the LCR analysis.
                </div>
            </div>
            <!--  Citation request ends here -->    




        </div>
        <!-- sidebar ends here -->

        <!-- Content panel starts here -->
        <div class="col-xs-7" style="width:1330px; margin-left:-15px">


            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Frequently Asked Questions</h3>
                </div>
                <div class="panel-body">

                    <ul>
                        <li><b>Why is there no light curve data for some of the sources listed in the source table on the index page?</b></li><p>
                    The light curve repository (LCR) provides flux estimates at three different cadences for >1500 sources from the 10-year Fermi-LAT point source catalog data release 2 (4FGL-DR2) which have a variability index above 21.67. While the table in the main page lists all 4FGL-DR2 sources, only the ones with variability index above 21.67 show embedded hyperlinks to the data products of the source.

                    <li><b>Can I download the light curves of more than one source at the time?</b></li><p>
                    The API links to the LCR backend interface allows for scripted access to the LCR database.  
                    
                    <li><b>Is it possible to fix the pop out charts that appear when I hover over a source in the map? They disappear before I can click on the links within them.</b></li><p>
                    Double clicking on the desired source in the map will fix the chart.

                    <li><b>Is there a document describing the data formats available for download?</b></li><p>
                    The light curve and JSON data formats are described <a href="table_description.html" target="_blank" onclick="window.open(this.href,'targetWindow','width=800px, height=1175px'); return false;">here</a>.

                    <BR><BR>
                    If your issue is not described in the list above, you can contact us through fermilcr@athena.gsfc.n

                    <BR>

                </div>
            </div>
        
        </div>
        <!-- Content panel ends here --> 

        <!-- </div> -->

         <!-- footer starts here --> 
        <div class="col-md-12" id="footer">
            <div id="footer-content">
                <p>
                    <hr>
                    Fermi LAT Light Curve Repository - Support Contact:<a href="mailto:fermilcr@athena.gsfc.nasa.gov"> fermilcr@athena.gsfc.nasa.gov</a>
                    <BR>
                    <BR>
                </p>
            </div>
        </div>
        <!-- footer ends here -->
    </div>
    <!-- Main ends here -->


</body>
</html>

